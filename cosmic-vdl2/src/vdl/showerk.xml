<project>
  <import file="sys.xml"/>
  <import file="scheduler.xml"/>
  <import file="rlog.xml"/>
  <import file="vdl.k"/>
  <types>
    <xs:schema targetNamespace="http://www.griphyn.org/2006/08/vdl" xmlns="http://www.griphyn.org/2006/08/vdl" xmlns:xs="http://www.w3.org/2001/XMLSchema">
      <xs:simpleType name="File">
        <xs:restriction base="xs:string"/>
      </xs:simpleType>
      <xs:complexType name="AxisParams">
        <xs:sequence>
          <xs:element name="low" type="xs:string"/>
          <xs:element name="high" type="xs:string"/>
          <xs:element name="label" type="xs:string"/>
        </xs:sequence>
      </xs:complexType>
    </xs:schema>
  </types>
  <element name="ThresholdTimes" arguments="thresholdData,rawData,detector">
    <vdl:typecheck argname="thresholdData" var="{thresholdData}" type="File" isArray="true"/>
    <vdl:typecheck argname="rawData" var="{rawData}" type="File" isArray="true"/>
    <vdl:typecheck argname="detector" var="{detector}" type="string"/>
    <vdl:execute>
      <vdl:tr>ThresholdTimes</vdl:tr>
      <vdl:stagein var="{rawData}"/>
      <vdl:stagein var="{detector}"/>
      <vdl:stageout var="{thresholdData}"/>
      <vdl:arguments>
        <vdl:filename var="{rawData}"/>	
        <vdl:filename var="{thresholdData}"/>	
        <vdl:getfieldvalue var="{detector}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{thresholdData}"/>
  </element>

  <element name="WireDelay" arguments="wireDelayData,thresholdData,geoDir,geoFiles">
    <vdl:typecheck argname="wireDelayData" var="{wireDelayData}" type="File" isArray="true"/>
    <vdl:typecheck argname="thresholdData" var="{thresholdData}" type="File" isArray="true"/>
    <vdl:typecheck argname="geoDir" var="{geoDir}" type="File"/>
    <vdl:typecheck argname="geoFiles" var="{geoFiles}" type="File" isArray="true"/>
    <vdl:execute>
      <vdl:tr>WireDelay</vdl:tr>
      <vdl:stagein var="{thresholdData}"/>
      <vdl:stagein var="{geoDir}"/>
      <vdl:stagein var="{geoFiles}"/>
      <vdl:stageout var="{wireDelayData}"/>
      <vdl:arguments>
        <vdl:filename var="{thresholdData}"/>	
        <vdl:filename var="{wireDelayData}"/>	
        <vdl:filename var="{geoDir}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{wireDelayData}"/>
  </element>

  <element name="Combine" arguments="combined,data">
    <vdl:typecheck argname="combined" var="{combined}" type="File"/>
    <vdl:typecheck argname="data" var="{data}" type="File" isArray="true"/>
    <vdl:execute>
      <vdl:tr>Combine</vdl:tr>
      <vdl:stagein var="{data}"/>
      <vdl:stageout var="{combined}"/>
      <vdl:arguments>
        <vdl:filenames var="{data}"/>	
        <vdl:filename var="{combined}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{combined}"/>
  </element>

  <element name="Sort" arguments="out,inf,key1,key2">
    <vdl:typecheck argname="out" var="{out}" type="File"/>
    <vdl:typecheck argname="inf" var="{inf}" type="File"/>
    <vdl:typecheck argname="key1" var="{key1}" type="string"/>
    <vdl:typecheck argname="key2" var="{key2}" type="string"/>
    <vdl:execute>
      <vdl:tr>Sort</vdl:tr>
      <vdl:stagein var="{inf}"/>
      <vdl:stagein var="{key1}"/>
      <vdl:stagein var="{key2}"/>
      <vdl:stageout var="{out}"/>
      <vdl:arguments>
        <vdl:filename var="{inf}"/>	
        <vdl:filename var="{out}"/>	
        <vdl:getfieldvalue var="{key1}"/>	
        <vdl:getfieldvalue var="{key2}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{out}"/>
  </element>

  <element name="EventSearch" arguments="out,inf,detectorCoincidence,channelCoincidence,eventCoincidence,gate">
    <vdl:typecheck argname="out" var="{out}" type="File"/>
    <vdl:typecheck argname="inf" var="{inf}" type="File"/>
    <vdl:typecheck argname="detectorCoincidence" var="{detectorCoincidence}" type="string"/>
    <vdl:typecheck argname="channelCoincidence" var="{channelCoincidence}" type="string"/>
    <vdl:typecheck argname="eventCoincidence" var="{eventCoincidence}" type="string"/>
    <vdl:typecheck argname="gate" var="{gate}" type="string"/>
    <vdl:execute>
      <vdl:tr>EventSearch</vdl:tr>
      <vdl:stagein var="{inf}"/>
      <vdl:stagein var="{detectorCoincidence}"/>
      <vdl:stagein var="{channelCoincidence}"/>
      <vdl:stagein var="{eventCoincidence}"/>
      <vdl:stagein var="{gate}"/>
      <vdl:stageout var="{out}"/>
      <vdl:arguments>
        <vdl:filename var="{inf}"/>	
        <vdl:filename var="{out}"/>	
        <vdl:getfieldvalue var="{gate}"/>	
        <vdl:getfieldvalue var="{detectorCoincidence}"/>	
        <vdl:getfieldvalue var="{channelCoincidence}"/>	
        <vdl:getfieldvalue var="{eventCoincidence}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{out}"/>
  </element>

  <element name="EventChoice" arguments="out,inf,eventNum,zeroZeroZeroID,geoDir,geoFiles">
    <vdl:typecheck argname="out" var="{out}" type="File"/>
    <vdl:typecheck argname="inf" var="{inf}" type="File"/>
    <vdl:typecheck argname="eventNum" var="{eventNum}" type="int"/>
    <vdl:typecheck argname="zeroZeroZeroID" var="{zeroZeroZeroID}" type="string"/>
    <vdl:typecheck argname="geoDir" var="{geoDir}" type="File"/>
    <vdl:typecheck argname="geoFiles" var="{geoFiles}" type="File" isArray="true"/>
    <vdl:execute>
      <vdl:tr>EventChoice</vdl:tr>
      <vdl:stagein var="{inf}"/>
      <vdl:stagein var="{eventNum}"/>
      <vdl:stagein var="{zeroZeroZeroID}"/>
      <vdl:stagein var="{geoDir}"/>
      <vdl:stagein var="{geoFiles}"/>
      <vdl:stageout var="{out}"/>
      <vdl:arguments>
        <vdl:filename var="{inf}"/>	
        <vdl:filename var="{out}"/>	
        <vdl:getfieldvalue var="{eventNum}"/>	
        <vdl:getfieldvalue var="{zeroZeroZeroID}"/>	
        <vdl:filename var="{geoDir}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{out}"/>
  </element>

  <element name="Plot" arguments="image,outfile_param,ptype,caption,x,y,z,title,infile,extraFun">
    <vdl:typecheck argname="image" var="{image}" type="File"/>
    <vdl:typecheck argname="outfile_param" var="{outfile_param}" type="File"/>
    <vdl:typecheck argname="ptype" var="{ptype}" type="string"/>
    <vdl:typecheck argname="caption" var="{caption}" type="string"/>
    <vdl:typecheck argname="x" var="{x}" type="AxisParams"/>
    <vdl:typecheck argname="y" var="{y}" type="AxisParams"/>
    <vdl:typecheck argname="z" var="{z}" type="AxisParams"/>
    <vdl:typecheck argname="title" var="{title}" type="string"/>
    <vdl:typecheck argname="infile" var="{infile}" type="File"/>
    <vdl:typecheck argname="extraFun" var="{extraFun}" type="File"/>
    <vdl:execute>
      <vdl:tr>Plot</vdl:tr>
      <vdl:stagein var="{ptype}"/>
      <vdl:stagein var="{caption}"/>
      <vdl:stagein var="{x}"/>
      <vdl:stagein var="{y}"/>
      <vdl:stagein var="{z}"/>
      <vdl:stagein var="{title}"/>
      <vdl:stagein var="{infile}"/>
      <vdl:stagein var="{extraFun}"/>
      <vdl:stageout var="{image}"/>
      <vdl:stageout var="{outfile_param}"/>
      <vdl:arguments>
        <string>-file</string>	
        <vdl:filename var="{infile}"/>	
        <string>-extra</string>	
        <vdl:filename var="{extraFun}"/>	
        <string>-param</string>	
        <vdl:filename var="{outfile_param}"/>	
        <string>-svg</string>	
        <vdl:filename var="{image}"/>	
        <string>-type</string>	
        <vdl:getfieldvalue var="{ptype}"/>	
        <string>-title</string>	
        <vdl:getfieldvalue var="{title}"/>	
        <string>-xlabel</string>	
        <vdl:getfieldvalue var="{x}" path="label"/>	
        <string>-ylabel</string>	
        <vdl:getfieldvalue var="{y}" path="label"/>	
        <string>-zlabel</string>	
        <vdl:getfieldvalue var="{z}" path="label"/>	
        <string>-caption</string>	
        <vdl:getfieldvalue var="{caption}"/>	
        <string>-lowx</string>	
        <vdl:getfieldvalue var="{x}" path="low"/>	
        <string>-highx</string>	
        <vdl:getfieldvalue var="{x}" path="high"/>	
        <string>-lowy</string>	
        <vdl:getfieldvalue var="{y}" path="low"/>	
        <string>-highy</string>	
        <vdl:getfieldvalue var="{y}" path="high"/>	
        <string>-lowz </string>	
        <vdl:getfieldvalue var="{z}" path="low"/>	
        <string>-highz</string>	
        <vdl:getfieldvalue var="{z}" path="high"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{image}"/>
    <vdl:closedataset var="{outfile_param}"/>
  </element>

  <set name="channelCoincidence">
    <vdl:new type="string" dbgname="channelCoincidence">
      <argument name="value">
        <vdl:arg>
            &quot;channelCoincidence&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="detectorCoincidence">
    <vdl:new type="string" dbgname="detectorCoincidence">
      <argument name="value">
        <vdl:arg>
            &quot;detectorCoincidence&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="eventCoincidence">
    <vdl:new type="string" dbgname="eventCoincidence">
      <argument name="value">
        <vdl:arg>
            &quot;eventCoincidence&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="eventNum">
    <vdl:new type="int" dbgname="eventNum">
      <argument name="value">
        <vdl:arg>
            &quot;eventNum&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="gate">
    <vdl:new type="string" dbgname="gate">
      <argument name="value">
        <vdl:arg>
            &quot;gate&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="zeroZeroZeroID">
    <vdl:new type="string" dbgname="zeroZeroZeroID">
      <argument name="value">
        <vdl:arg>
            &quot;zeroZeroZeroID&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="eventCandidates">
    <vdl:new type="File" dbgname="eventCandidates">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;eventCandidates&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="eventFile">
    <vdl:new type="File" dbgname="eventFile">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;eventFile&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="rawData">
    <vdl:new type="File" dbgname="rawData" isArray="true">
      <vdl:mapping descriptor="array_mapper">
        <vdl:parameter name="files">
          <vdl:arg>
              &quot;rawData&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="true"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="thresholdAll">
    <vdl:new type="File" dbgname="thresholdAll" isArray="true">
      <vdl:mapping descriptor="array_mapper">
        <vdl:parameter name="files">
          <vdl:arg>
              &quot;thresholdAll&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="wireDelayData">
    <vdl:new type="File" dbgname="wireDelayData" isArray="true">
      <vdl:mapping descriptor="array_mapper">
        <vdl:parameter name="files">
          <vdl:arg>
              &quot;wireDelayData&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="detector">
    <vdl:new type="string" dbgname="detector">
      <argument name="value">
        <vdl:arg>
            &quot;detector&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="combineOut">
    <vdl:new type="File" dbgname="combineOut">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;combineOut&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="sortOut">
    <vdl:new type="File" dbgname="sortOut">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;sortOut&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="geoDir">
    <vdl:new type="File" dbgname="geoDir">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;geoDir&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="true"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="geoFiles">
    <vdl:new type="File" dbgname="geoFiles" isArray="true">
      <vdl:mapping descriptor="array_mapper">
        <vdl:parameter name="files">
          <vdl:arg>
              &quot;geoFiles&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="true"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="plot_caption">
    <vdl:new type="string" dbgname="plot_caption">
      <argument name="value">
        <vdl:arg>
            &quot;plot_caption&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="extraFun_out">
    <vdl:new type="File" dbgname="extraFun_out">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;extraFun_out&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="true"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="x">
    <vdl:new type="AxisParams" dbgname="x">
      <vdl:mapping descriptor="temp_mapper">
        <vdl:parameter name="prefix" value="x-7f55d6c6-b337-4ba5-8e1b-1728ca4c489f"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="y">
    <vdl:new type="AxisParams" dbgname="y">
      <vdl:mapping descriptor="temp_mapper">
        <vdl:parameter name="prefix" value="y-2585a88a-9cfe-4b79-bab7-f039bae194d4"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="z">
    <vdl:new type="AxisParams" dbgname="z">
      <vdl:mapping descriptor="temp_mapper">
        <vdl:parameter name="prefix" value="z-889cab45-e79b-464f-8508-d1a5709ba19f"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <vdl:assign dpath="high" dvar="{x}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_highX&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="low" dvar="{x}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_lowX&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="label" dvar="{x}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_xlabel&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="high" dvar="{y}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_highY&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="low" dvar="{y}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_lowY&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="label" dvar="{y}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_ylabel&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="high" dvar="{z}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_highZ&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="low" dvar="{z}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_lowZ&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="label" dvar="{z}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_zlabel&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <set name="plot_outfile_param">
    <vdl:new type="File" dbgname="plot_outfile_param">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;plot_outfile_param&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="plot_plot_type">
    <vdl:new type="string" dbgname="plot_plot_type">
      <argument name="value">
        <vdl:arg>
            &quot;plot_plot_type&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="plot_outfile_image">
    <vdl:new type="File" dbgname="plot_outfile_image">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;plot_outfile_image&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="plot_title">
    <vdl:new type="string" dbgname="plot_title">
      <argument name="value">
        <vdl:arg>
            &quot;plot_title&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="sort_sortKey1">
    <vdl:new type="string" dbgname="sort_sortKey1">
      <argument name="value">
        <vdl:arg>
            &quot;sort_sortKey1&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="sort_sortKey2">
    <vdl:new type="string" dbgname="sort_sortKey2">
      <argument name="value">
        <vdl:arg>
            &quot;sort_sortKey2&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <restartLog>
    <parallel>
      <ThresholdTimes>
        <parallel>
          <variable>thresholdAll</variable>
          <variable>rawData</variable>
          <variable>detector</variable>
        </parallel>
      </ThresholdTimes>
      <WireDelay>
        <parallel>
          <variable>wireDelayData</variable>
          <variable>thresholdAll</variable>
          <variable>geoDir</variable>
          <variable>geoFiles</variable>
        </parallel>
      </WireDelay>
      <Combine>
        <parallel>
          <variable>combineOut</variable>
          <variable>wireDelayData</variable>
        </parallel>
      </Combine>
      <Sort>
        <parallel>
          <variable>sortOut</variable>
          <variable>combineOut</variable>
          <variable>sort_sortKey1</variable>
          <variable>sort_sortKey2</variable>
        </parallel>
      </Sort>
      <EventSearch>
        <parallel>
          <variable>eventCandidates</variable>
          <variable>sortOut</variable>
          <variable>channelCoincidence</variable>
          <variable>detectorCoincidence</variable>
          <variable>eventCoincidence</variable>
          <variable>gate</variable>
        </parallel>
      </EventSearch>
      <EventChoice>
        <parallel>
          <variable>eventFile</variable>
          <variable>eventCandidates</variable>
          <variable>eventNum</variable>
          <variable>zeroZeroZeroID</variable>
          <variable>geoDir</variable>
          <variable>geoFiles</variable>
        </parallel>
      </EventChoice>
      <Plot>
        <parallel>
          <variable>plot_outfile_image</variable>
          <variable>plot_outfile_param</variable>
          <variable>plot_plot_type</variable>
          <variable>plot_caption</variable>
          <variable>x</variable>
          <variable>y</variable>
          <variable>z</variable>
          <variable>plot_title</variable>
          <variable>eventFile</variable>
          <variable>extraFun_out</variable>
        </parallel>
      </Plot>
    </parallel>
  </restartLog>  
</project>
