<project>
  <import file="sys.xml"/>
  <import file="scheduler.xml"/>
  <import file="rlog.xml"/>
  <import file="vdl.k"/>
  <types>
    <xs:schema targetNamespace="http://www.griphyn.org/2006/08/vdl" xmlns="http://www.griphyn.org/2006/08/vdl" xmlns:xs="http://www.w3.org/2001/XMLSchema">
      <xs:simpleType name="File">
        <xs:restriction base="xs:string"/>
      </xs:simpleType>
      <xs:complexType name="AxisParams">
        <xs:sequence>
          <xs:element name="low" type="xs:string"/>
          <xs:element name="high" type="xs:string"/>
          <xs:element name="label" type="xs:string"/>
        </xs:sequence>
      </xs:complexType>
    </xs:schema>
  </types>
  <element name="ThresholdTimes" arguments="thresholdData,rawData,detector">
    <vdl:typecheck argname="thresholdData" var="{thresholdData}" type="File" isArray="true"/>
    <vdl:typecheck argname="rawData" var="{rawData}" type="File" isArray="true"/>
    <vdl:typecheck argname="detector" var="{detector}" type="string"/>
    <vdl:execute>
      <vdl:tr>ThresholdTimes</vdl:tr>
      <vdl:stagein var="{rawData}"/>
      <vdl:stagein var="{detector}"/>
      <vdl:stageout var="{thresholdData}"/>
      <vdl:arguments>
        <vdl:filename var="{rawData}"/>	
        <vdl:filename var="{thresholdData}"/>	
        <vdl:getfieldvalue var="{detector}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{thresholdData}"/>
  </element>

  <element name="Combine" arguments="combined,data">
    <vdl:typecheck argname="combined" var="{combined}" type="File"/>
    <vdl:typecheck argname="data" var="{data}" type="File" isArray="true"/>
    <vdl:execute>
      <vdl:tr>Combine</vdl:tr>
      <vdl:stagein var="{data}"/>
      <vdl:stageout var="{combined}"/>
      <vdl:arguments>
        <vdl:filename var="{data}"/>	
        <vdl:filename var="{combined}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{combined}"/>
  </element>

  <element name="SingleChannel" arguments="out,inf,channel">
    <vdl:typecheck argname="out" var="{out}" type="File" isArray="true"/>
    <vdl:typecheck argname="inf" var="{inf}" type="File"/>
    <vdl:typecheck argname="channel" var="{channel}" type="int"/>
    <vdl:execute>
      <vdl:tr>SingleChannel</vdl:tr>
      <vdl:stagein var="{inf}"/>
      <vdl:stagein var="{channel}"/>
      <vdl:stageout var="{out}"/>
      <vdl:arguments>
        <vdl:filename var="{inf}"/>	
        <vdl:filename var="{out}"/>	
        <vdl:getfieldvalue var="{channel}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{out}"/>
  </element>

  <element name="Frequency" arguments="out,inf,binType,binValue,col">
    <vdl:typecheck argname="out" var="{out}" type="File" isArray="true"/>
    <vdl:typecheck argname="inf" var="{inf}" type="File" isArray="true"/>
    <vdl:typecheck argname="binType" var="{binType}" type="string"/>
    <vdl:typecheck argname="binValue" var="{binValue}" type="string"/>
    <vdl:typecheck argname="col" var="{col}" type="string"/>
    <vdl:execute>
      <vdl:tr>Frequency</vdl:tr>
      <vdl:stagein var="{inf}"/>
      <vdl:stagein var="{binType}"/>
      <vdl:stagein var="{binValue}"/>
      <vdl:stagein var="{col}"/>
      <vdl:stageout var="{out}"/>
      <vdl:arguments>
        <vdl:filename var="{inf}"/>	
        <vdl:filename var="{out}"/>	
        <vdl:getfieldvalue var="{col}"/>	
        <vdl:getfieldvalue var="{binType}"/>	
        <vdl:getfieldvalue var="{binValue}"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{out}"/>
  </element>

  <element name="Plot" arguments="image,outfile_param,ptype,caption,x,y,z,title,infile">
    <vdl:typecheck argname="image" var="{image}" type="File"/>
    <vdl:typecheck argname="outfile_param" var="{outfile_param}" type="File"/>
    <vdl:typecheck argname="ptype" var="{ptype}" type="string"/>
    <vdl:typecheck argname="caption" var="{caption}" type="string"/>
    <vdl:typecheck argname="x" var="{x}" type="AxisParams"/>
    <vdl:typecheck argname="y" var="{y}" type="AxisParams"/>
    <vdl:typecheck argname="z" var="{z}" type="AxisParams"/>
    <vdl:typecheck argname="title" var="{title}" type="string"/>
    <vdl:typecheck argname="infile" var="{infile}" type="File" isArray="true"/>
    <vdl:execute>
      <vdl:tr>Plot</vdl:tr>
      <vdl:stagein var="{ptype}"/>
      <vdl:stagein var="{caption}"/>
      <vdl:stagein var="{x}"/>
      <vdl:stagein var="{y}"/>
      <vdl:stagein var="{z}"/>
      <vdl:stagein var="{title}"/>
      <vdl:stagein var="{infile}"/>
      <vdl:stageout var="{image}"/>
      <vdl:stageout var="{outfile_param}"/>
      <vdl:arguments>
        <string>-file</string>	
        <vdl:filenames var="{infile}"/>	
        <string>-param</string>	
        <vdl:filename var="{outfile_param}"/>	
        <string>-svg</string>	
        <vdl:filename var="{image}"/>	
        <string>-type</string>	
        <vdl:getfieldvalue var="{ptype}"/>	
        <string>-title</string>	
        <vdl:getfieldvalue var="{title}"/>	
        <string>-xlabel</string>	
        <vdl:getfieldvalue var="{x}" path="label"/>	
        <string>-ylabel</string>	
        <vdl:getfieldvalue var="{y}" path="label"/>	
        <string>-zlabel</string>	
        <vdl:getfieldvalue var="{z}" path="label"/>	
        <string>-caption</string>	
        <vdl:getfieldvalue var="{caption}"/>	
        <string>-lowx</string>	
        <vdl:getfieldvalue var="{x}" path="low"/>	
        <string>-highx</string>	
        <vdl:getfieldvalue var="{x}" path="high"/>	
        <string>-lowy</string>	
        <vdl:getfieldvalue var="{y}" path="low"/>	
        <string>-highy</string>	
        <vdl:getfieldvalue var="{y}" path="high"/>	
        <string>-lowz </string>	
        <vdl:getfieldvalue var="{z}" path="low"/>	
        <string>-highz</string>	
        <vdl:getfieldvalue var="{z}" path="high"/>	
      </vdl:arguments>

    </vdl:execute>
    <vdl:closedataset var="{image}"/>
    <vdl:closedataset var="{outfile_param}"/>
  </element>

  <set name="rawData">
    <vdl:new type="File" dbgname="rawData" isArray="true">
      <vdl:mapping descriptor="array_mapper">
        <vdl:parameter name="files">
          <vdl:arg>
              &quot;rawData&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="true"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="thresholdAll">
    <vdl:new type="File" dbgname="thresholdAll" isArray="true">
      <vdl:mapping descriptor="array_mapper">
        <vdl:parameter name="files">
          <vdl:arg>
              &quot;thresholdAll&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="combineOut">
    <vdl:new type="File" dbgname="combineOut">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;combineOut&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="detector">
    <vdl:new type="string" dbgname="detector">
      <argument name="value">
        <vdl:arg>
            &quot;detector&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="freq_binType">
    <vdl:new type="string" dbgname="freq_binType">
      <argument name="value">
        <vdl:arg>
            &quot;freq_binType&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="freq_binValue">
    <vdl:new type="string" dbgname="freq_binValue">
      <argument name="value">
        <vdl:arg>
            &quot;freq_binValue&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="freq_col">
    <vdl:new type="string" dbgname="freq_col">
      <argument name="value">
        <vdl:arg>
            &quot;freq_col&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="singlechannelOut">
    <vdl:new type="File" dbgname="singlechannelOut" isArray="true">
      <vdl:mapping descriptor="array_mapper">
        <vdl:parameter name="files">
          <vdl:arg>
              &quot;singlechannelOut&quot;
          </vdl:arg>
        </vdl:parameter>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="freqOut">
    <vdl:new type="File" dbgname="freqOut" isArray="true">
      <vdl:mapping descriptor="array_mapper">
        <vdl:parameter name="files">
          <vdl:arg>
              &quot;freqOut&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="plot_caption">
    <vdl:new type="string" dbgname="plot_caption">
      <argument name="value">
        <vdl:arg>
            &quot;plot_caption&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="x">
    <vdl:new type="AxisParams" dbgname="x">
      <vdl:mapping descriptor="temp_mapper">
        <vdl:parameter name="prefix" value="x-cefa0c39-b5da-4b86-a763-0a45729d93cd"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="y">
    <vdl:new type="AxisParams" dbgname="y">
      <vdl:mapping descriptor="temp_mapper">
        <vdl:parameter name="prefix" value="y-a53fccea-8c97-4e19-92c3-bb455ac70df9"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="z">
    <vdl:new type="AxisParams" dbgname="z">
      <vdl:mapping descriptor="temp_mapper">
        <vdl:parameter name="prefix" value="z-2d6e1066-9cd9-4dd2-855e-6b7750ea3126"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <vdl:assign dpath="high" dvar="{x}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_highX&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="low" dvar="{x}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_lowX&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="label" dvar="{x}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_xlabel&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="high" dvar="{y}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_highY&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="low" dvar="{y}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_lowY&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="label" dvar="{y}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_ylabel&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="high" dvar="{z}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_highZ&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="low" dvar="{z}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_lowZ&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <vdl:assign dpath="label" dvar="{z}">
    <argument name="svar">
  	<vdl:arg>
  	    &quot;plot_zlabel&quot;
  	</vdl:arg>
    </argument>
  </vdl:assign>
  <set name="plot_outfile_param">
    <vdl:new type="File" dbgname="plot_outfile_param">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;plot_outfile_param&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="plot_plot_type">
    <vdl:new type="string" dbgname="plot_plot_type">
      <argument name="value">
        <vdl:arg>
            &quot;plot_plot_type&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="plot_outfile_image">
    <vdl:new type="File" dbgname="plot_outfile_image">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;plot_outfile_image&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="plot_title">
    <vdl:new type="string" dbgname="plot_title">
      <argument name="value">
        <vdl:arg>
            &quot;plot_title&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <set name="singlechannel_channel">
    <vdl:new type="int" dbgname="singlechannel_channel">
      <argument name="value">
        <vdl:arg>
            &quot;singlechannel_channel&quot;
        </vdl:arg>
      </argument>
    </vdl:new>
  </set>
  <restartLog>
    <parallel>
      <ThresholdTimes>
        <parallel>
          <variable>thresholdAll</variable>
          <variable>rawData</variable>
          <variable>detector</variable>
        </parallel>
      </ThresholdTimes>
      <Combine>
        <parallel>
          <variable>combineOut</variable>
          <variable>thresholdAll</variable>
        </parallel>
      </Combine>
      <SingleChannel>
        <parallel>
          <variable>singleChannelOut</variable>
          <variable>combineOut</variable>
          <variable>singlechannel_channel</variable>
        </parallel>
      </SingleChannel>
      <Frequency>
        <parallel>
          <variable>freqOut</variable>
          <variable>singleChannelOut</variable>
          <variable>freq_binType</variable>
          <variable>freq_binValue</variable>
          <variable>freq_col</variable>
        </parallel>
      </Frequency>
      <Plot>
        <parallel>
          <variable>plot_outfile_image</variable>
          <variable>plot_outfile_param</variable>
          <variable>plot_plot_type</variable>
          <variable>plot_caption</variable>
          <variable>x</variable>
          <variable>y</variable>
          <variable>z</variable>
          <variable>plot_title</variable>
          <variable>freqOut</variable>
        </parallel>
      </Plot>
    </parallel>
  </restartLog>  
</project>
