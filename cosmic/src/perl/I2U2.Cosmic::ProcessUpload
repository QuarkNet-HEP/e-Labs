#!/bin/bash

IN=
APPDIR=`dirname $0`
DATADIR=
DETECTOR=

error() {
	echo $@
	exit 3
}

check() {
	if [ "$2" == "" ]; then
		error "Missing $1 argument"
	fi
}

mark() {
	echo "-PROGRESS-"
}

while [ "$1" != "" ]; do
	if [ "${1:0:1}" == "-" ]; then
		P=${1:1}
		if [ "${P#in=}" != "$P" ]; then
			IN=${P#in=}
		elif [ "${P#datadir=}" != "$P" ]; then
			DATADIR=${P#datadir=}
		elif [ "${P#detectorid=}" != "$P" ]; then
			DETECTOR=${P#detectorid=}
		fi
		shift
	else
		error "Invalid parameter: $1. Does not start with '-'"
	fi
done

check "input file" $IN
check "datadir" $DATADIR
check "detectorid" $DETECTOR

ls -al $IN

$APPDIR/Split.pl "$IN" $DATADIR/$DETECTOR $DETECTOR 2>&1
if [ "$?" != "0" ]; then 
	error "Split failed" 
fi

mark

gzip $IN 2>&1
if [ "$?" != "0" ]; then 
	error "Gzip failed" 
fi

mark