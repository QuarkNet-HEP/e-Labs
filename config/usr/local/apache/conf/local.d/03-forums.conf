# Web server configuation for I2U2 logbook/discussion site (based on BOINC)
#
# This file is included by the main web server configuration file httpd.conf 
# in the directory just above.
#
#  @(#) Last changed: -EAM 10Dec2008
######################################################################

DocumentRoot "/home/i2u2/boinc/html/user"
#UserDir disabled

# This server will be used across many timezones, using data
# collected using UTC and GPS times.  So set the server default
# timezone to be GMT for universal use (and confusion? :-)
#
setEnv TZ GMT

#  Names of files to use as "index" (if only directory name given)
#
DirectoryIndex index.php index.html index.htm index.shtml

# Convert any references to .htm files (but not .html files) 
# into .php files (This allows us to make .php files include .htm bodies.)
#
RewriteEngine on
RewriteRule   (.*)\.htm$   $1.php  [R]

   # Links to .shtml pages are to be grabbed from FNAL site
   #
   #RewriteRule   (.*)\.shtml$   show_page.php?p=$1.shtml  [QSA,R]
   #RewriteRule   (.*)\.lasso$   show_page.php?p=$1.lasso  [QSA,R]


#####################
# Forums served from the e-Lab level

AliasMatch ^/elab/(.*)/forum/user_profile/(.*)$  /home/i2u2/boinc/html/user_profile/$2
AliasMatch ^/elab/(.*)/forum/(.*)$	         /home/i2u2/boinc/html/user/$2


##################################


##
# User profile pages.
# (Note that this needs to be writeable by httpd for full functionality.)
#
Alias      /user_profile    /home/i2u2/boinc/html/user_profile


##
# Site Control Panel
#
Alias      /ops             /home/i2u2/boinc/html/ops


# Misspellings get redirected:
#
RedirectMatch permanent  /cosmics(.*)  /cosmic$1


   # Leftovers from BOINC (we may still want?)
   #
   #Alias      /download        /home/i2u2/boinc/download
   #Alias      /stats           /home/i2u2/boinc/html/stats


   # Necessary for cgi programs to find GCC-3.3 libraries in /usr/local/lib?
   # (Is this needed anymore?   Seems not, at least on alvarez. -EAM 20Aug2007)
   #
   ## SetEnv LD_LIBRARY_PATH /usr/local/lib:/usr/lib


ScriptAlias  /cgi-bin /home/i2u2/boinc/cgi-bin



#####################
# Directories and their permissions & options


   # The default document root is set above to /home/i2u2/html/user,
   # just as for a BOINC project,  but the directories above that should
   # NOT be published!  Anything which is to be published then needs to 
   # be specifically listed via alias above and configured below

   <Directory "/home/i2u2/">
        Order deny,allow
        Deny from all
    </Directory>


    # 'top level' URL for the BOINC forums
    #
    <Directory "/home/i2u2/boinc/html/user">
        Options FollowSymlinks MultiViews IncludesNoExec
        AllowOverride Limit Indexes

        Order allow,deny
        Allow from all

    </Directory>


    # User profiles (needs to be apache writeable for some functionality)
    #
    <Directory "/home/i2u2/boinc/html/user_profile">
        Options IncludesNoExec
        AllowOverride AuthConfig Limit FileInfo

        Order allow,deny
        Allow from all

    </Directory>


    # Control panel.  Access should now be based on user's role, not
    #  on HTTP Basic authentiction, but uncomment if you need it
    #
    <Directory "/home/i2u2/boinc/html/ops">
        Options Indexes FollowSymlinks MultiViews IncludesNoExec
        AllowOverride FileInfo AuthConfig Limit Indexes 

        Order allow,deny
	Allow from all

	# Authentication (now in .htaccess file)
	#
	#AuthType Basic
	#AuthName "Tool, LIGO Analysis (TLA)"
	#AuthUserFile  /home/i2u2/tla_test/etc/tla-passwd
	#AuthGroupFile /dev/null
	#Require valid-user
	#Satisfy any

    </Directory>



    #########################
    # Separate e-Lab areas: 
    #
    <Directory "/home/i2u2/ligo/">
        Options Indexes SymLinksIfOwnerMatch IncludesNoExec
        AllowOverride AuthConfig Limit Indexes

        Order allow,deny
        Allow from all

        <IfModule mod_include.c>
           XBitHack Full
        </IfModule>
    </Directory>

    <Directory "/home/i2u2/cosmic/">
        Options Indexes SymLinksIfOwnerMatch IncludesNoExec
        AllowOverride AuthConfig Limit Indexes

        Order allow,deny
        Allow from all

        <IfModule mod_include.c>
           XBitHack Full
        </IfModule>
    </Directory>

    <Directory "/home/i2u2/cms/">
        Options Indexes SymLinksIfOwnerMatch IncludesNoExec
        AllowOverride AuthConfig Limit Indexes

        Order allow,deny
        Allow from all

        <IfModule mod_include.c>
           XBitHack Full
        </IfModule>
    </Directory>

    # Raw testing.  Turn this OFF when you don't need it. 
    # 
    <Directory "/home/i2u2/test/">
        Options Indexes SymLinksIfOwnerMatch IncludesNoExec
        AllowOverride AuthConfig Limit Indexes

        Order allow,deny
        Allow from all

        <IfModule mod_include.c>
           XBitHack Full
        </IfModule>
    </Directory>


    #########################
    # Leftovers from BOINC (we may still use them.  Maybe not.)
    #
    <Directory "/home/i2u2/boinc/download">
	 Options Indexes FollowSymlinks MultiViews
	 AllowOverride AuthConfig Limit
	 Order allow,deny
	 Allow from all
    </Directory>

    <Directory "/home/i2u2/boinc/upload">
	 Order deny,allow
	 Deny  from all
    </Directory>

    <Directory "/home/i2u2/boinc/html/stats">
	 Options Indexes MultiViews
	 AllowOverride AuthConfig Limit
	 Order allow,deny
	 Allow from all
    </Directory>

    <Directory "/home/i2u2/html/boinc/stats_archive">
	 Options Indexes MultiViews
	 AllowOverride AuthConfig Limit
	 Order allow,deny
	 Allow from all
    </Directory>

    <Directory "/home/i2u2/boinc/cgi-bin">
	 Options ExecCGI
	 AllowOverride AuthConfig Limit
	 Order allow,deny
	 Allow from all
    </Directory>


#</VirtualHost>

##
