<project>
  <import file="sys.xml"/>
  <import file="scheduler.xml"/>
  <import file="rlog.xml"/>
  <import file="vdl.k"/>
  <types>
    <xs:schema targetNamespace="http://www.griphyn.org/2006/08/vdl" xmlns="http://www.griphyn.org/2006/08/vdl" xmlns:xs="http://www.w3.org/2001/XMLSchema">
      <xs:simpleType name="file">
        <xs:restriction base="xs:string"/>
      </xs:simpleType>
    </xs:schema>
  </types>
  <element name="rootInvoke" arguments="t,o,s">
    <vdl:typecheck var="{t}" type="file"/>
    <vdl:typecheck var="{o}" type="file"/>
    <vdl:typecheck var="{s}" type="file"/>
    <vdl:execute>
      <vdl:tr>rootInvoke</vdl:tr>
      <vdl:stagein var="{s}"/>
      <vdl:stageout var="{t}"/>
      <vdl:stageout var="{o}"/>
      <vdl:arguments>
        <vdl:filename var="{s}"/>
      </vdl:arguments>
      <vdl:stdout>
        <vdl:filename var="{o}"/>
      </vdl:stdout>
    </vdl:execute>
    <vdl:closedataset var="{t}"/>
    <vdl:closedataset var="{o}"/>
  </element>

  <element name="bash" arguments="t,o,script">
    <vdl:typecheck var="{t}" type="file"/>
    <vdl:typecheck var="{o}" type="file"/>
    <vdl:typecheck var="{script}" type="file"/>
    <vdl:execute>
      <vdl:tr>bash</vdl:tr>
      <vdl:stagein var="{script}"/>
      <vdl:stageout var="{t}"/>
      <vdl:stageout var="{o}"/>
      <vdl:arguments>
        <vdl:filename var="{script}"/>
        <vdl:filename var="{t}"/>
      </vdl:arguments>
      <vdl:stdout>
        <vdl:filename var="{o}"/>
      </vdl:stdout>
    </vdl:execute>
    <vdl:closedataset var="{t}"/>
    <vdl:closedataset var="{o}"/>
  </element>

  <set name="script">
    <vdl:new type="file" dbgname="script">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;scriptFile&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="true"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="img">
    <vdl:new type="file" dbgname="img">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;outputFile&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <set name="out">
    <vdl:new type="file" dbgname="out">
      <vdl:mapping descriptor="fixed_mapper">
        <vdl:parameter name="file">
          <vdl:arg>
              &quot;rawOutData&quot;
          </vdl:arg>
        </vdl:parameter>
        <vdl:parameter name="input" value="false"/>
      </vdl:mapping>
    </vdl:new>
  </set>
  <restartLog>
    <parallel>
      <rootInvoke>
        <parallel>
          <variable>img</variable>
          <variable>out</variable>
          <variable>script</variable>
        </parallel>
      </rootInvoke>
    </parallel>
  </restartLog>  
</project>